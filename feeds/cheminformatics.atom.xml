<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Not always an expert - Cheminformatics</title><link href="https://fredrikw.github.io/" rel="alternate"></link><link href="https://fredrikw.github.io/feeds/cheminformatics.atom.xml" rel="self"></link><id>https://fredrikw.github.io/</id><updated>2019-04-15T00:00:00+02:00</updated><subtitle>Cheminformatics, python, data science...</subtitle><entry><title>conda-openbabel on Windows</title><link href="https://fredrikw.github.io/conda-openbabel-windows.html" rel="alternate"></link><published>2019-04-15T00:00:00+02:00</published><updated>2019-04-15T00:00:00+02:00</updated><author><name>Fredrik Wallner</name></author><id>tag:fredrikw.github.io,2019-04-15:/conda-openbabel-windows.html</id><summary type="html">&lt;p&gt;Trying to fix InChI support on conda version of OpenBabel on Windows&lt;/p&gt;</summary><content type="html">&lt;p&gt;I recently needed to use openbabel on Windows and decided to install it through conda since I use conda as my Python environment manager on that machine.&lt;/p&gt;
&lt;p&gt;Installing openbabel, either by &lt;code&gt;conda install -c openbabel openbabel&lt;/code&gt; or &lt;code&gt;conda install -c conda-forge openbabel&lt;/code&gt; worked great and I proceded with my code. However, after a while I noticed that the InChI-format was missing from the install.&lt;/p&gt;
&lt;p&gt;Going for Google and friends, there was some indications that this is a &lt;a href="http://forums.openbabel.org/Problem-with-Pybel-installation-for-Anaconda-td4659541.html#a4659544"&gt;known problem&lt;/a&gt; with &lt;a href="https://github.com/openbabel/conda-openbabel/tree/windows-inchi"&gt;some efforts&lt;/a&gt; going into solving it.&lt;/p&gt;
&lt;p&gt;But it still didn't work for me, so I set out to fix it.&lt;/p&gt;
&lt;h3&gt;Appveyour build failing&lt;/h3&gt;
&lt;p&gt;After cloning the &lt;a href="https://github.com/openbabel/conda-openbabel/"&gt;repo&lt;/a&gt; and setting up AppVeyour, I immediately bumped inte the first problem. conda-build refused to work on AppVeyour, giving the error &lt;code&gt;TypeError: LoadLibrary() argument 1 must be str, not None&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Further research showed that changes made in conda 3.16 made builds without prior activation of a conda environment fail. &lt;a href="https://github.com/conda/conda-build/issues/3220#issuecomment-430697863"&gt;Apparently&lt;/a&gt;, the fact that it worked previously was not by design, but it meant that build settings that previously worked great stopped doing so with a rather crytic error message.&lt;/p&gt;
&lt;p&gt;When the problem was found, solving it was as easy as adding the &lt;code&gt;activate&lt;/code&gt; command to the install section in &lt;a href="https://github.com/fredrikw/conda-openbabel/commit/5bd6220ea4b445bd57593cb28492e99ebdb99078"&gt;appveyour.yml&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Tests not failing&lt;/h3&gt;
&lt;p&gt;The second problem was that the tests in the conda recipe didn't fail, even when formats were missing, since obabel exits with the exit code 0 also when all conversion fails. An &lt;a href="https://github.com/fredrikw/conda-openbabel/commit/6e9f098e26ad882e885036e104edaa8102befda1"&gt;easy fix here&lt;/a&gt; was to grep for some specific text in the outputs instead and use that exit code to signal failure.&lt;/p&gt;
&lt;h3&gt;Actual InChI problem&lt;/h3&gt;
&lt;p&gt;Now I could finally fix the main problem. The build logs in AppVeyour included&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;WARNING: INCHI_LIBRARY not set, or does not exist.
....InChI format will NOT be compiled.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and looking in the cmake files it seemed to be due to &lt;a href="https://github.com/openbabel/openbabel/blob/cd85a984a439314d090fab76f0520061939fe6bf/CMakeLists.txt#L199-L201"&gt;these lines&lt;/a&gt; that forces the use of system InChI if OB_USE_PREBUILT_BINARIES is set on MSVC builds. Why this is so, and why the conda build is set to use prebuilt binaries, I don't know. But setting OB_USE_PREBUILT_BINARIES to OFF in the build instructions made everything work for me.&lt;/p&gt;
&lt;p&gt;The changes have now been submitted as a PR, so we will see what happens.&lt;/p&gt;</content><category term="OpenBabel"></category><category term="conda"></category><category term="Cheminformatics"></category></entry></feed>